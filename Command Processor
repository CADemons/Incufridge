#include "Arduino.h"
#define End_of_command '#'
#define max_command_length 60
#define FIRST 0
#define End_of_string 0

char command [max_command_length];
int index = FIRST;

void setup() {
  Serial.begin(9600);
}

void AddCharacterToCommand(int nextCharacter) {
  if(index < max_command_length)
  {
    command[index] = nextCharacter;
    index++;
  }
}

void ProcessCommand() {
  int nextCharacter;
  void (*f)(int) = AddCharacterToCommand;
  if(Serial.available() > 0)
  { 
    nextCharacter = Serial.read();
    if ((nextCharacter >= 'a') && (nextCharacter <= 'z'))
    { 
      AddCharacterToCommand(nextCharacter);
    }
    else if ((nextCharacter >= 'A') && (nextCharacter <= 'Z'))
    { 
      AddCharacterToCommand(nextCharacter);
    }
    else if ((nextCharacter >= '0') && (nextCharacter <= '9'))
    { 
      AddCharacterToCommand(nextCharacter);
    }
    else
    {
      if (nextCharacter == End_of_command)
      {
        //look up Command
        AddCharacterToCommand(End_of_string);
      
        Serial.print(command);
        index = FIRST;
      }
    
    }
  }
}

void loop() {
  ProcessCommand();
}
